.TH LUMOS-SEQUENCE 5
.SH NAME
Lumos Sequence File \- script for light displays run by Lumos
.SH DESCRIPTION
.LP
The Lumos light orchestration system plays pre-programmed sequences
of light channel patterns.  This document explains the format of the ASCII
file which is read by Lumos to load these sequences prior to executing them.
.LP
The overall format of the file is the common Comma-Separated Value ('CSV') format.
Each line of the file describes one record, which may contain sequence data for a
single light channel, a repeating pattern, or other information.  Each record (line) is 
divided into fields which are separated by commas.  A field may itself be enclosed
in double quotes (although it need not be), which allows it to contain embedded 
commas.  Within a quoted string, a double double quote ('""') signifies a literal double quote character.
.LP
The first field of every record specifies the record's type, and may have one of 
the following values:
.TP
.B E
Event.  This record describes a channel value change event.  This includes 
four more fields, as follows:
.RS
.TP
.I u
The controller unit index, as an integer value (0 being the controller described
by the first 
.B U
record encountered in the file, 1 being the next, etc.) or the special value
.RB \*(lq * \*(rq
which means the event applies to 
.I all
controllers in the system.
.TP
.I ch
The channel index, as an integer value (0 being the first channel listed for
this controller in the corresponding
.B U
record, 1 being the next channel listed, etc.; these may not be the same
as the device's channel numbers if not all channels are being used), or the
special value
.RB \*(lq * \*(rq
which means the event applies to
.I all
channels of this controller.  If the unit index for this event was
.RB \*(lq * \*(rq,
then the channel must also be
.RB \*(lq * \*(rq.
.TP
.I v
The value to change the channel to, as a floating-point percentage, where 0
represents fully off, and 100 represents fully on.  Device channels incapable
of dimming should be set to 0 or 100, although it is generally the case that
any value greater than 0 is considered \*(lqon\*(rq for such devices.
.TP
.I dT
The amount of time over which the transition to the value
.I v
is to be made.  If an instant change is required, this value would be 0.
This is an integer value measured in milliseconds.
.RE
.TP
.B T
Timestamp.  The next field is an (integer) number of milliseconds measured from the
start of the sequence.  All event records listed after this point will occur at
that time in the sequence.  These do not need to appear in chronological order,
and in fact a later
.B T
record may duplicate the time value of a previous one (in which case their events
will be merged and all take place at that time in the sequence).
.TP
.B U
Controller unit declaration.  The next field is the ID tag for a controller unit
used in this sequence.  Following this are one or more fields giving the ID tags
for each channel used in this sequence.  This record must appear before any event
record referencing this controller unit.
.TP
.BI V n
This must be the first record in the sequence.  The number
.I n
specifies what version of this format is being used for this file.  This document
describes version 2.
The remainder of the record is ignored.
.SH EXAMPLE
.LP
A file which controls channel C7 of the controller called \*(lqfloods\*(rq,
and three channels (0, 1, 2, and 3) of the controller called \*(lqtree\*(rq,
which ramps up the floods over 2 seconds, then at 7s in drops them to half
brightness; sequences each tree channel for 1s each in turn, then ramps each
up from off to on in 1s each and holds them there, then at 00:00:10.000 fades
everything to black over a 1s period, would look like this:
.RS
.na
.nf
V2,Lumos sequence file,test.lseq
U,floods,C7
U,tree,0,1,2,3
T,0
E,*,*,0,0
T,1000
E,0,0,100,2000
E,1,0,100,0
T,2000
E,1,0,0,0
E,1,1,100,0
T,3000
E,1,1,0,0
E,1,2,100,0
T,4000
E,1,2,0,0
E,1,3,100,0
T,5000
E,1,0,100,1000
T,6000
E,1,1,100,1000
T,7000
E,1,2,100,1000
E,0,0,50,0
T,8000
E,1,3,100,1000
T,10000
E,*,*,0,1000
.fi
.ad
.RE
.SH VERSION
.LP
This documents the Lumos sequence file version 2, for software version 1.0.  Not 
released yet.
.SH AUTHOR
.LP
Steve Willoughby / steve@alchemy.com
.SH HISTORY
.LP
Version 1 file format created 6 September 2005.  This version is deprecated and
no longer supported by Lumos (this was never in a released version of the software).
.br
Version 2 file format created 25 September 2008 (described here).
.SH BUGS
.LP
We still need to work out a more sophisticated repeat block protocol.
