\section*{NAME}
lumosctl -- Manual control for Lumos SSR controller hardware
\section*{SYNOPSIS}
\codetype{lumosctl}
[\codetype{--dFhkPRrSvwXz}]
[\codetype{--a}
\Var*{addr}]
[\codetype{--A}
\Var*{addr}]
[\codetype{--b}
\Var*{speed}]
[\codetype{--B}
\Var*{speed}]
[\codetype{--c}
\Var*{file}]
[\codetype{--C}
\Var*{file}]
[\codetype{--D}
\Var*{sens}]
[\codetype{--E}
\Var*{sens}]
[\codetype{--H}
\Var*{hexfile}]
[\codetype{--L}
\Var*{level}]
[\codetype{--m}
\Var*{mS}]
[\codetype{--p}
\Var*{port}]
[\codetype{--P}
\Var*{phase}]
[\codetype{--s}
\Var*{file}]
[\codetype{--T}
\Var*{mode}]
[\codetype{--t}
\Var*{s}\codetype{\textnormal{[}orw+\textnormal{]}:}\Var*{init}\codetype{:}\Var*{seq}\codetype{:}\Var*{term\textnormal{]}}
[\codetype{--x}
\Var*{duplex}\codetype{]}
\Var*{channel-outputs}\dots 


Where
\Var*{channel-outputs}
may be any combination of:
\begin{center}


\Var*{channel}[\codetype{@}\Var*{level}[\codetype{,}\dots ]]
\\
\Var*{channel}\codetype{d}[\Var*{\codetype{:}steps}[\Var*{\codetype{:}time}]]
\\
\Var*{channel}\codetype{u}[\Var*{\codetype{:}steps}[\Var*{\codetype{:}time}]]
\\
\codetype{x}\Var*{id}
\\
\codetype{p}\Var*{time}
\end{center}
\section*{DESCRIPTION}


This command allows you to directly manipulate the state of a
supported Lumos
SSR controller unit, including administration functions
such as changing the unit's address, phase offset, etc.


Other software such as 
\codetype{lumos}(1)
or---providing appropriate drivers are installed---popular
third-party programs such as Vixen are more appropriate for
performing (``playing'') sequences of light patterns on
these boards.  By contrast, 
\codetype{lumosctl}
is more suited to setting up and configuring the boards (although some
basic real-time control of channel outputs is possible using
\codetype{lumosctl}).


In the absence of any command-line options to the contrary, the
normal 
operation of
\codetype{lumosctl}
is to make a number of channel output level 
changes as determined by the non-option arguments which are of the
form:
\begin{center}
\Var*{channel}
\end{center}
or
\begin{center}
\Var*{channel}\codetype{@}\Var*{level}\codetype{\textnormal{[},\textnormal{\dots ]}}
\end{center}
or
\begin{center}
\Var*{channel}\codetype{\textnormal{\{}u\textnormal{|}d\textnormal{\}[}:}\Var*{steps}\codetype{\textnormal{[}:}\Var*{time}\codetype{\textnormal{]]}}
\end{center}


In the first case, a channel number by itself means to turn on that 
channel to full brightness.  In the second case, by specifying a level value
(a number from 0 to 255, inclusive), that channel's output is dimmed
to the given level.  Level 255 is the same as turning on to full 
brightness; level 0 is the same as turning it fully off.


In the third case, the dimmer level is ramped up smoothly from its current
value to full brightness 
(``\codetype{u}''),
or down smoothly until fully off
(``\codetype{d}'').
Optionally you may specify the number of dimmer level increments
to increase or decrease at each change (1--128, default is 1); additionally,
you may specify the amount of time to wait between each step, in units
of 1/120 second (1--128, default is 1).  As a convenience, this may be
expressed as a real number of seconds followed by the letter 
``\codetype{s}''.
Thus, the argument
\codetype{13@127}
sets channel 13 to half brightness.  If this were followed by the argument
\codetype{13u}
then channel 13 would be smoothly increased in brightness from there to full
brightness (which is another 128 levels to take it from 127 to 255), 
by incrementing it one level every 1/120th of a second, reaching a full
brightness level 128/120 seconds later (1.0666 seconds).  If the 
argument
\codetype{13d:10:2}
were given, then channel 13 would drop to being fully off, going in steps
of 10 levels at a time, 1/60th of a second between each step.
Finally, an argument
\codetype{10u:5:0.25s}
fades channel 10 up from its current value to full brightness by incrementing
its value by 5 every quarter-second.


Bulk updating of channels is also supported.  If multiple values are listed
for a channel, such as:
\codetype{10@0,0,255,255,127,40,30,20,10}


Then the channel named (10 in this example) is assigned the first value
(0), and the subsequent values are assigned to the immediately following
channels (so channel 11 is set to 0, 12 is set to 255, and so forth).


A pause in the execution of the arguments may be effected by adding an
argument of the form 
\codetype{p}\Var*{t}\codetype{\textnormal{[}s\textnormal{[}ec\textnormal{[}ond\textnormal{[}s\textnormal{]]]]}}
which makes
\codetype{lumosctl}
pause for
\Var*{t}
seconds before continuing on to the next argument.  The
\Var*{t}
value need not be an integer.


A number of options are provided as described below.  These command
the SSR controller to perform certain administrative functions or 
configuration changes.


When giving multiple types of commands in one invocation of this
program, they will be carried out in the following order:
\begin{enumerate}
% tagged paragraph, width=4
\item
Address Change
% tagged paragraph, width=4
\item
Kill all channels
% tagged paragraph, width=4
\item
Other configuration changes
% tagged paragraph, width=4
\item
Disable configuration mode
% tagged paragraph, width=4
\item
Channel(s) off/on/dim/etc.
% tagged paragraph, width=4
\item
Shutdown
\end{enumerate}
\section*{OPTIONS}


Each of the following options may be specified by either a long
option (like
``\codetype{----verbose}'')
or a shorter option letter (like
``\codetype{--v}'').
If an option takes a parameter, it may follow the option as
``\codetype{--a12}'',
``\codetype{--a 12}'',
``\codetype{----address 12}'',
or
``\codetype{----address=12}''.


Long option names may be abbreviated to any unambiguous initial substring.
\begin{list}{}{}
% tagged paragraph, width=27
\item[{\codetype{----address=}\Var*{addr}}]\hfill\\
(\codetype{--a}
\Var*{addr})
Specifies the address of the target controller unit.  The
\Var*{addr}
value is an integer from 0 to 15, inclusive.  It defaults to 0.
% tagged paragraph, width=4
\item[{\codetype{----clear--sequences}}]\hfill\\
(\codetype{--S})
Delete all stored sequences from the device's memory.
\strong{[This is a future feautre, currently not available on Lumos boards.]}
% tagged paragraph, width=4
\item[{\codetype{----disable--sensor=}\Var*{s}}]\hfill\\
(\codetype{--D}
\Var*{s})
Disable inputs from the sensor(s) specified as the
\Var*{s}
parameter (which are given as a set of one or more letters,
e.g., 
\codetype{----disable--sensor=ab}).
The Lumos board will act as though those sensors were 
inactive regardless of their actual inputs.
The special character
``\codetype{*}''
appearing in 
\Var*{s}
means to disable all sensors.
\strong{[This is a future feautre, currently not available on Lumos boards.]}
% tagged paragraph, width=4
\item[{\codetype{----drop--configuration--mode}}]\hfill\\
(\codetype{--d})
If the Lumos device is in configuration command mode (for configuraiton of
the device), this will cancel that mode.  Further configuration commands will
not be recognized on that device.
% tagged paragraph, width=4
\item[{\codetype{----dump--configuration--file=}\Var*{file}}]\hfill\\
(\codetype{--C}
\Var*{file})
Dump the device configuration into the named
\Var*{file}.
See below for a description of the configuration file format.
% tagged paragraph, width=4
\item[{\codetype{----enable--sensor=}\Var*{s}}]\hfill\\
(\codetype{--E}
\Var*{s})
Enable inputs from the sensor(s) specified as the 
\Var*{s}
parameter.  See 
\codetype{----disable--sensor}.
\strong{[This is a future feautre, currently not available on Lumos boards.]}
% tagged paragraph, width=4
\item[{\codetype{----factory--reset}}]\hfill\\
(\codetype{--F})
Resets the board to its initial default settings, as it would have arrived ``out of the box''
as it were (of course this is a DIY project, so there's no actual ``factory'' but if there
were one, these are the defaults the board would come shipped with).  This can also be accomplished
by inserting a jumper on the board in the correct sequence.  See the Lumos controller user's manual
for details.
% tagged paragraph, width=4
\item[{\codetype{----help}}]\hfill\\
(\codetype{--h})
Prints a summary of these options and exits.
% tagged paragraph, width=4
\item[{\codetype{----kill--all}}]\hfill\\
(\codetype{--k})
Turn off all output channels at once.
% tagged paragraph, width=4
\item[{\codetype{----load--compiled--sequence=}\Var*{file}}]\hfill\\
(\codetype{--H}
\Var*{file})
Load one or more pre-compiled sequences from the specified hex 
\Var*{file}.
This is expected to be the output from the 
\codetype{lumosasm}(1)
command.
\strong{[This is a future feautre, currently not available on Lumos boards.]}
% tagged paragraph, width=4
\item[{\codetype{----load--configuration--file=}\Var*{file}}]\hfill\\
(\codetype{--c}
\Var*{file})
Load the device configuration from the named
\Var*{file}
and program that into the device.
% tagged paragraph, width=4
\item[{\codetype{----load--sequence=}\Var*{file}}]\hfill\\
(\codetype{--s}
\Var*{file})
Load one or more sequences from the specified source
\Var*{file}
(see below for sequence source code syntax) and program them
into the device.  If another sequence already exists with the
same number, it replaces the old one; however, beware that the
controller device does not optimize memory storage, so eventually
stored sequences may become fragmented, resulting in running out of
storage space for them.  To avoid this, it is best to clear all
sequences using the
\codetype{----clear--sequences}
option, then load all the sequences you want on the device at once.
\strong{[This is a future feautre, currently not available on Lumos boards.]}
% tagged paragraph, width=4
\item[{\codetype{----port=}\Var*{port}}]\hfill\\
(\codetype{--p}
\Var*{port})
Specify the serial port to use when communicating with the controller
unit.  This may be a simple integer value (0 for the first serial port
on the system, 1 for the next one, etc.) or the actual device name
on your system (such as 
``\codetype{COM1}''
or
``\codetype{/dev/ttys0}'').
% tagged paragraph, width=4
\item[{\codetype{----probe}}]\hfill\\
(\codetype{--P})
Search for, and report on, all Lumos controllers attached to the serial network.
If the
\codetype{----report}
option is also specified, this provides that level of output for every attached
device; otherwise, it only lists device models and addresses.
% tagged paragraph, width=4
\item[{\codetype{----read--only}}]\hfill\\
(\codetype{--r})
Do not query the Lumos board's status.  Normally, 
\codetype{lumosctl}
reads back the board status at the start and after each configuration change
to ensure that the changes were successful.  If you are using the board under
conditions where getting data from the Lumos board is not possible (e.g., if your
RS-485 adapter doesn't support a return channel), use the
\codetype{--r}
option to suppress this part of
\codetype{lumosctl}'s
behavior.  This means that configuration requests are sent ``blindly'' to
the Lumos board without any way to confirm that they took effect.  (The name
of this option seems backwards, but it was named from the Lumos board's point
of view---that is, it sees its data connection as a read-only source of data
and won't try to send any data back to the PC.)
% tagged paragraph, width=4
\item[{\codetype{----report}}]\hfill\\
(\codetype{--R})
Report on the current device status to standard output in human-readable form.
% tagged paragraph, width=4
\item[{\codetype{----sensor=}\Var*{s}\codetype{\textnormal{[}orw+\textnormal{]}:}\Var*{init}\codetype{:}\Var*{seq}\codetype{:}\Var*{term}}]\hfill\\
(\codetype{--t}
\Var*{s}\codetype{\textnormal{[}orw+\textnormal{]}:}\Var*{init}\codetype{:}\Var*{seq}\codetype{:}\Var*{term}\codetype{\textnormal{)}}
Define an action to be taken when a sensor is triggered.  When the sensor
is activated, the sequence
\Var*{init}
is run, followed by the sequence
\Var*{seq}
and then finally the sequence
\Var*{term}
when the sensor event is over.  The sensor assigned this action is given
as the parameter
\Var*{s}
and is one of the letters 
\codetype{A},
\codetype{B},
\codetype{C},
or
\codetype{D}.
This may be followed by the following option letters as needed:
\begin{itemize}
% tagged paragraph, width=4
\item[{\codetype{o}}]
Trigger once: play sequence
\Var*{seq}
only one time.  The action will not be taken again until the sensor
input transitions to inactive and then asserts itself as active again.
This is the default action.
% tagged paragraph, width=4
\item[{\codetype{r}}]
Repeat mode: play sequence
\Var*{seq}
indefinitely until explicitly told to stop (by an overt stop command
such as an
\codetype{x0}
argument, or another sequence being triggered manually or by sensor
action).
% tagged paragraph, width=4
\item[{\codetype{w}}]
Trigger while active: play sequence
\Var*{seq}
repeatedly as long as the sensor remains active.  When the sensor input
transitions to inactive again, terminate the action.
% tagged paragraph, width=4
\item[{\codetype{+}}]
The sensor is to be considered ``active'' when at a logic
high output (active-high mode).  Normally, sensors are active-low
(active when the input is at ground).
\end{itemize}


If 0 is specified for any of the sequence numbers, that means no
sequence is called for that part of the trigger action.


\strong{[This is a future feautre, currently not available on Lumos boards.]}
% tagged paragraph, width=4
\item[{\codetype{----set--address=}\Var*{addr}}]\hfill\\
(\codetype{--A}
\Var*{addr})
Change the device address to
\Var*{addr}.
This must be an integer in the range 0--15.
% tagged paragraph, width=4
\item[{\codetype{----set--baud--rate=}\Var*{speed}}]\hfill\\
(\codetype{--B}
\Var*{rate})
Set a new baud rate for the device to start using from now on.
% tagged paragraph, width=4
\item[{\codetype{----set--phase=}\Var*{offset}}]\hfill\\
(\codetype{--P}
\Var*{offset})
Set the phase 
\emph{offset}
in the device to the specified value.  This must be an integer in the range 0--511.
\emph{This is an advanced setting which affects the ability of the AC relay boards to}
\emph{function properly. Do not change this setting unless you know exactly what you are doing.}
% tagged paragraph, width=4
\item[{\codetype{----sleep}}]\hfill\\
(\codetype{--z})
Tell the unit to go to sleep (this instructs the board to turn off a
power supply which it is controlling, if any, but has no other effect).
% tagged paragraph, width=4
\item[{\codetype{----shutdown}}]\hfill\\
(\codetype{--X})
Command the unit to shut down completely.  It will be unresponsive until
power cycled or the reset button is pressed to reboot the controller.
% tagged paragraph, width=4
\item[{\codetype{----speed=}\Var*{rate}}]\hfill\\
(\codetype{--b}
\Var*{rate})
Set the serial port to the given
baud
\Var*{rate}.
[Default is 19200 baud.]
% tagged paragraph, width=4
\item[{\codetype{----txdelay=}\Var*{mS}}]\hfill\\
(\codetype{--m}
\Var*{mS})
Delay 
\Var*{mS}
milliseconds between each transition from transmitting to receiving mode and vice versa.
Usually only needed for half-duplex networks.
% tagged paragraph, width=4
\item[{\codetype{----txlevel=}\Var*{level}}]\hfill\\
(\codetype{--L}
\Var*{level})
Transmit mode is controlled by either the DTR or RTS lines.  This option controls what logic level
on that line means to engage the transmitter.  The value of
\Var*{level}
may be either 
``\codetype{0}''
to mean a logic low (off) indicates transmit mode, or
``\codetype{1}''
to mean a logic high (on) is used.
% tagged paragraph, width=4
\item[{\codetype{----txmode=}\Var*{line}}]\hfill\\
(\codetype{--T}
\Var*{line})
Specifies which serial control line is used to control the RS-485 transmitter.  The
value for 
\Var*{line}
may be either
``\codetype{dtr}''
or
``\codetype{rts}''.
% tagged paragraph, width=4
\item[{\codetype{----wake}}]\hfill\\
(\codetype{--w})
Tell the unit to start the attached power supply from sleep mode.
command is given at a future time.
% tagged paragraph, width=4
\item[{\codetype{----verbose}}]\hfill\\
(\codetype{--v})
Output messages to the standard output.  Additional 
\codetype{----verbose}
options increases verbosity.  High levels of verbosity include a dump
of every bit sent or received on the serial network.
\end{list}
\section*{CONFIGURATION FILE FORMAT}


The files read and written by the 
\codetype{----dump--configuration}
and
\codetype{----load--configuration}
options use a fairly standard configuration file format similar to the
``ini'' files used by early versions of Microsoft Windows and other 
systems.  For full details of this format see
\codetype{http://docs.python.org/library/configparser.html},
but the highlights include:
\begin{enumerate}
% tagged paragraph, width=3
\item
One data value per line (long lines may be continued by indentation ala RFC 822 headers).
% tagged paragraph, width=4
\item
Each line consists of the name of a data value, either an equals sign or a colon,
and the value itself.
% tagged paragraph, width=4
\item
A syntax 
\codetype{\%(}\Var*{name}\codetype{)s}
can be used to substitute values into other values.  Literal percent signs in values
are simply doubled 
(``\codetype{\%\%}'').
\end{enumerate}


All configration data are contained in a stanza called
``\codetype{[lumos\_device\_settings]}''.
The values are detailed individually below.
\strong{Note that some of these describe anticipated future features of the Lumos hardware that are not available at this time.}
These future features are recognized by 
\codetype{lumosctl}
as documented here, but won't actually have any effect until they are fully implemented in the Lumos
firmware.
\begin{list}{}{}
% tagged paragraph, width=4
\item[{\codetype{baud=}\Var*{n}}]\hfill\\
The configured serial I/O speed of the device.  Supported values include 300, 600, 1200, 2400,
4800, 9600, 19200, 38400, 57600, 115200, and 250000.  Speeds slower than 9600 baud
are not recommended. [Default is 19200.]
% tagged paragraph, width=4
\item[{\codetype{dmxchannel=}\Var*{n}}]\hfill\\
If this field exists, the Lumos board is to run in DMX512 mode, with its channel \#0 appearing
at DMX512 slot 
\#\Var*{n},
where
\Var*{n}
is an integer in the range 1--512.
If this field is not present, the Lumos board will not be configured to recognize DMX512 packets
at all.
% tagged paragraph, width=4
\item[{\codetype{phase=}\Var*{offset}}]\hfill\\
The AC waveform phase offset for the unit.  This should only be changed if needed due to some
anomaly with the zero-crossing detector which throws off the unit's timing.  This is an integer
in the range 0--511.  [Default is 2.]
% tagged paragraph, width=4
\item[{\codetype{sensors=}\Var*{list}}]\hfill\\
The value is a list of single letters in the range A--D.  Each letter appearing in this
list indicates that the corresponding sensor input should be enabled in the hardware.
You must ensure that the hardware is really configured that way.  
\end{list}
\subsection*{Sensor Configuration}


For each sensor listed in the 
\codetype{sensors}
field, a corresponding stanza called 
``\codetype{[lumos\_device\_sensor\_\Var*{x}]}''
appears, where 
\Var*{x}
is the name of the sensor 
(``\codetype{A}'',
``\codetype{B}'',
``\codetype{C}'',
or
``\codetype{D}''),
with the following fields:
\begin{list}{}{}
% tagged paragraph, width=4
\item[{\codetype{enabled=}\Var*{bool}}]\hfill\\
If 
``\codetype{yes}'',
the sensor input is set to be monitored.  If
``\codetype{no}'',
it is ignored.  [Default is 
``\codetype{yes}''.]
% tagged paragraph, width=4
\item[{\codetype{mode=}\{\codetype{once}|\codetype{repeat}|\codetype{while}\}}]\hfill\\
Define the operating mode of the sensor trigger: play once per trigger,
repeat forever until another trigger (or explicit command to stop), or
play as long as sensor remains active. [Default is 
\codetype{once}.]
% tagged paragraph, width=4
\item[{\codetype{setup=}\Var*{id}}]\hfill\\
Sequence
\Var*{id}
number to be played initially when the sensor becomes active
% tagged paragraph, width=4
\item[{\codetype{sequence=}\Var*{id}}]\hfill\\
Sequence
\Var*{id}
number to be played as the main (possibly repeated) aciton for the sensor.
% tagged paragraph, width=4
\item[{\codetype{terminate=}\Var*{id}}]\hfill\\
Sequence
\Var*{id}
number to be played when the action stops. Note that the
main sequence might not have played to completion.
\end{list}
\section*{SEQUENCE SOURCE SYNTAX}


Each source file given to 
\codetype{----load--sequence}
contains one or more sequence definitions as described here.  The formal syntax
definition for the sequence language is still being designed and will be documented
here when it is implemented.
\section*{AUTHOR}


Software Alchemy / support@alchemy.com
\section*{COMPATIBILITY}


This version of 
\codetype{lumosctl}
is compatible with the following boards:
\begin{itemize}
% tagged paragraph, width=2
\item
Lumos 48-channel controller version 3.1 or 3.2
\emph{providing it has been upgraded or installed with ROM firmware version 3.0 or later}
(boards with ID markings beginning with ``48CTL-3-1'' or ``LUMOS-48CTL-3.2'').  (Whether this controller is
driving AC or DC boards is irrelevant.)
% tagged paragraph, width=4
\item
Lumos 24-channel DC controller version 1.0 (boards with ID markings beginning with
``LUMOS-24SSR-DC-1.0'').
\end{itemize}
\section*{HISTORY}



This program first appeared under the name
\codetype{48ssrctl}
and was used only for the Lumos 48-channel AC controller boards, employing the
older firmware (ROM versions less than
3.\emph{x}).


This document describes version 2.0 of this utility, which is the first to carry
this name and to include the expanded features for firmware version 3.0.
\section*{SEE ALSO}
\codetype{lumosasm}(1).
\section*{LIMITATIONS}


This program does not send DMX512 commands to the device(s), only Lumos native
commands.
\section*{BUGS}


Sometimes 
\codetype{lumosctl}
doesn't correctly track board configuration changes and incorrectly reports that 
the Lumos board's configuration was ``not as expected'' even though the operation
was successful.  If this happens, try running
\codetype{lumosctl}
\codetype{--R}
to get a fresh report of the board's status and verify that it is configured as desired.


The sequence language is constrained by the limits of the hardware (such as 8-bit
unsigned integer values and limited arithmetic expression evaluation), 
by the need to 
be compiled to fit in a very small memory space.  As such, the optimization
toward certain use cases and against others may seem odd at first, but it serves that
purpose.


Submit any other issues found to 
\codetype{support@alchemy.com}.
